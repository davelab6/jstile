<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
        "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
    <title>TileScript</title>
    <link href="tilescript.css" rel="stylesheet" type="text/css"/>

    <!-- script type="text/javascript" src="LivelyKernel-SourceCode-0.7/prototype.js"></script -->
    <script type="text/javascript" src="prototype.js"></script>

    <script type="text/javascript" src="scriptaculous/scriptaculous.js?load=effects,dragdrop"></script>
    <script type="text/javascript" src="network.js"></script>
    <script type="text/javascript" src="tilescript.js"></script>

    <script type="text/javascript" src="ometa-js/lib.js"></script>
    <script type="text/javascript" src="ometa-js/ometa-base.js"></script>
    <script type="text/javascript" src="ometa-js/parser.js"></script>
    <script type="text/javascript" src="ometa-js/squeak-parser.js"></script>
    <script type="text/javascript" src="ometa-js/squeak-lib.js"></script>
    <script type="text/javascript" src="ometa-js/ometa-parser.js"></script>

    <script type="text/javascript">

window.onload = function() {
  eval(OMetaParser.matchAllwith(document.getElementById("omsparser").text, "grammar").squish().join(''))
  OMetaSqueakParser.translate = function(s) { return this.matchAllwith(s, "iTranslate") }
  OMetaSqueakParser.eval      = function(s) { return eval(this.translate(s)) }
  OMetaSqueakParser.eval(document.getElementById("mdsparser").text)
  //OMetaSqueakParser.eval(document.getElementById("jsparser").text)
  eval(document.getElementById("jsparser").text)
  initializeDocument();
}

    </script>

<script type="application/x-ometa" id="omsparser">
ometa OMetaSqueakParser : Parser {
  topLevelExpr  ::= <foreign OMetaParser  #grammar>
                  | <foreign SqueakParser #expr>.
  topLevelExprs ::= <listOf #topLevelExpr '.'>:r (<token '.'> | <empty>) <spaces> <end> => [r delimWith: '; '].
  iTranslate    ::= <topLevelExprs>:r                                                   => [r squish join: ''].
}
</script>

<script type="application/x-ometa" id="mdsparser">
ometa MDefSqueakParser : SqueakParser {
  unaryMsgPat       ::= <identifier>:m                        => [{{$'. m. $'}. {}}].
  binaryMsgPat      ::= <binary>:m  <identifier>:a            => [{m squish join: ''. {a}}].
  keywordMsgPatPart ::= <keyword>:k <identifier>:a            => [{k. a}].                    
  keywordMsgPat     ::= <keywordMsgPatPart>+:parts                                            
                          ![parts collect: [:p | p at: 0]]:ks                                 
                          ![parts collect: [:p | p at: 1]]:as                                
                          ![ks squish join: '']:ks            => [{{$'. ks escape. $'}. as}]. 
  msgPat            ::= <keywordMsgPat>                                                        
                      | <binaryMsgPat>                                                         
                      | <unaryMsgPat>.                                                         
  methodDef         ::= <identifier>:cls <msgPat>:nameAndArgs <block false>:body              
                          => [cls,, '.prototype[',, (nameAndArgs at: 0),, '] = ',,           
                              'function(',, ((nameAndArgs at: 1) delimWith: ', '),, ') { ',,  
                                'var $elf = this; ',,                                         
                                'try { (',, body,, ')() } ',,                                 
                                'catch (_r) { ',,                                             
                                  'if (_r instanceof Return) return _r.value;',,               
                                  'else throw _r } return this }'].                            
}.                                                                                             
ometa NewSqueakParser {                                                                        
   expr ::= <foreign MDefSqueakParser #methodDef>                                              
          | <foreign MDefSqueakParser #expr>.                                                  
}.                                                                                             
SqueakParser := NewSqueakParser.
</script>

<script type="application/x-ometa" id="jsparser_">

ometa JSParser : Parser {
  nameFirst    ::= <letter>        | '$'.
  nameRest     ::= <letterOrDigit> | '$'.
  iName        ::= <firstAndRest #nameFirst #nameRest>:r                                           => [r join: ''].
  name         ::= <iName>:n ?[(self isKeyword: n) not]                                            => [{#name. n}].
  keyword      ::= <iName>:k ?[self isKeyword: k]                                                  => [{k. k}].
  number       ::= <digit>+:ds                                                                     => [{#number. parseInt value: (ds join: '')}].
  escapeChar   ::= '\\' <char>:c                                                                   => ['\\', c].
  str          ::= "'" (<escapeChar> | ~"'" <char>)*:cs "'"                                        => [{#string. cs join: ''}]
                 | '"' (<escapeChar> | ~'"' <char>)*:cs '"'                                        => [{#string. cs join: ''}].
  special      ::= ( "("   | ")"   | "{"   | "}"   | "["  | "]"  | "," | ";"  | "?" | ":"
                   | "!==" | "!="  | "===" | "=="  | "="  | ">=" | ">" | "<=" | "<" | "++"
                   | "+="  | "+"   | "--"  | "-="  | "-"  | "*=" | "*" | "/=" | "/" | "%="
                   | "%"   | "&&=" | "&&"  | "||=" | "||" | "."  | "!"                    ):s      => [{s. s}].
  tok          ::= <spaces> (<name> | <keyword> | <number> | <str> | <special>).
  toks         ::= <token>*:ts <spaces> <end>                                                      => [ts].
  token :tt    ::= <tok>:t ?[(t at: 0) = tt]                                                       => [t at: 1].
  spacesNoNl   ::= (~'\n' <space>)*.

  expr         ::= <orExpr>:e ( <token '?'>   <expr>:t <token ':'> <expr>:f                        => [{#condExpr. e. t. f}]
                              | <token '='>   <expr>:rhs                                           => [{#set.  e. rhs}]
                              | <token '+='>  <expr>:rhs                                           => [{#mset. e. #+.    rhs}]
                              | <token '-='>  <expr>:rhs                                           => [{#mset. e. #-.    rhs}]
                              | <token '*='>  <expr>:rhs                                           => [{#mset. e. #*.    rhs}]
                              | <token '/='>  <expr>:rhs                                           => [{#mset. e. #/.    rhs}]
                              | <token '%='>  <expr>:rhs                                           => [{#mset. e. #%.    rhs}]
                              | <token '&&='> <expr>:rhs                                           => [{#mset. e. #&&.   rhs}]
                              | <token '||='> <expr>:rhs                                           => [{#mset. e. #'||'. rhs}]
                              | <empty>                                                            => [e]
                              ).
  orExpr       ::= <orExpr>:x <token '||'> <andExpr>:y                                             => [{#binop. #'||'. x. y}]
                 | <andExpr>.
  andExpr      ::= <andExpr>:x <token '&&'> <eqExpr>:y                                             => [{#binop. #&&. x. y}]
                 | <eqExpr>.
  eqExpr       ::= <eqExpr>:x ( <token '=='>  <relExpr>:y                                          => [{#binop. #==.  x. y}]
                              | <token '!='>  <relExpr>:y                                          => [{#binop. #!=.  x. y}]
                              | <token '==='> <relExpr>:y                                          => [{#binop. #===. x. y}]
                              | <token '!=='> <relExpr>:y                                          => [{#binop. #!==. x. y}]
                              )
                 | <relExpr>.
  relExpr      ::= <relExpr>:x ( <token '>'>          <addExpr>:y                                  => [{#binop. #>.  x. y}]
                               | <token '>='>         <addExpr>:y                                  => [{#binop. #>=. x. y}]
                               | <token '<'>          <addExpr>:y                                  => [{#binop. #<.  x. y}]
                               | <token '<='>         <addExpr>:y                                  => [{#binop. #>=. x. y}]
                               | <token 'instanceof'> <addExpr>:y                                  => [{#binop. #instanceof. x. y}]
                               )
                 | <addExpr>.
  addExpr      ::= <addExpr>:x <token '+'> <mulExpr>:y                                             => [{#binop. #+. x. y}]
                 | <addExpr>:x <token '-'> <mulExpr>:y                                             => [{#binop. #-. x. y}]
                 | <mulExpr>.
  mulExpr      ::= <mulExpr>:x <token '*'> <mulExpr>:y                                             => [{#binop. #*. x. y}]
                 | <mulExpr>:x <token '/'> <mulExpr>:y                                             => [{#binop. #/. x. y}]
                 | <mulExpr>:x <token '%'> <mulExpr>:y                                             => [{#binop. #%. x. y}]
                 | <unary>.
  unary        ::= <token '-'>  <postfix>:p                                                        => [{#unop.  #-.   p}]
                 | <token '+'>  <postfix>:p                                                        => [p]
                 | <token '++'> <postfix>:p                                                        => [{#preOp. #++.  p}]
                 | <token '--'> <postfix>:p                                                        => [{#preOp. #--.  p}]
                 | <token '!'>  <postfix>:p                                                        => [{#unop.  #!.   p}]
                 | <postfix>.
  postfix      ::= <primExpr>:p ( <spacesNoNl> <token '++'>                                        => [{#postOp. #++. p}]
                                | <spacesNoNl> <token '--'>                                        => [{#postOp. #--. p}]
                                | <empty>                                                          => [p]
                                ).
  primExpr     ::= <primExpr>:p
                     ( <token '['> <expr>:i <token ']'>                                            => [{#get.  i. p}]
                     | <token '.'> <token 'name'>:m <token '('> <listOf #expr ','>:as <token ')'>  => [{#send. m. p} concat: as]
                     | <token '.'> <token 'name'>:f                                                => [{#get.  {#string. f}. p}]
                     | <token '('> <listOf #expr ','>:as <token ')'>                               => [{#call. p} concat: as]
                     )
                 | <primExprHd>.
  primExprHd   ::= <token '('> <expr>:e <token ')'>                                                => [e]
                 | <token 'this'>                                                                  => [{#this}]
                 | <token 'name'>:n                                                                => [{#get. n}]
                 | <token 'number'>:n                                                              => [{#number. n}]
                 | <token 'string'>:s                                                              => [{#string. s}]
                 | <token 'function'> <funcRest>
                 | <token 'new'> <token 'name'>:n <token '('> <listOf #expr ','>:as <token ')'>    => [{#new. n} concat: as]
                 | <token '['> <listOf #expr ','>:es <token ']'>                                   => [{#arr} concat: es]
                 | <json>.
  json         ::= <token '{'> <listOf #jsonBinding ','>:bs <token '}'>                            => [{#json} concat: bs].
  jsonBinding  ::= <jsonPropName>:n <token ':'> <expr>:v                                           => [{#binding. n. v}].
  jsonPropName ::= <token 'name'> | <token 'number'> | <token 'string'>.
  formal       ::= <spaces> <token 'name'>.
  funcRest     ::= <token '('> <listOf #formal ','>:fs <token ')'>
                     <token '{'> <srcElems>:body <token '}'>                                       => [{#func. {#formals} concat: fs. body}].
  sc           ::= <spacesNoNl> ('\n' | &'}' | <end>)
                 | <token ';'>.
  binding      ::= <token 'name'>:n ( <token '='> <expr>
                                    | <empty> => [{#get. 'undefined'}] ):v                         => [{#var. n. v}].
  block        ::= <token '{'> <srcElems>:ss <token '}'>                                           => [ss].
  stmt         ::= <block>
                 | <token 'var'> <listOf #binding ','>:bs <sc>                                     => [{#begin} concat: bs]
                 | <token 'if'> <token '('> <expr>:c <token ')'> <stmt>:t
                     ( <token 'else'> <stmt>
                     | <empty> => [{#get. 'undefined'}] ):f                                        => [{#if. c. t. f}]
                 | <token 'while'> <token '('> <expr>:c <token ')'> <stmt>:s                       => [{#while.   c. s}]
                 | <token 'do'> <stmt>:s <token 'while'> <token '('> <expr>:c <token ')'> <sc>     => [{#doWhile. s. c}]
                 | <token 'for'> <token '('> ( <token 'var'> <binding>
                                             | <expr>
                                             | <empty> => [{#get. 'undefined'}] ):i
                                 <token ';'> ( <expr>
                                             | <empty> => [{#get. 'true'}]      ):c
                                 <token ';'> ( <expr>
                                             | <empty> => [{#get. 'undefined'}] ):u
                                 <token ')'>
                       <stmt>:s                                                                    => [{#for. i. c. u. s}]
                 | <token 'for'> <token '('> ( <token 'var'> <token 'name'>:n
                                                            => [{#var. n. {#get. 'undefined'}}]
                                            | <expr>                                            ):v
                                <token 'in'> <expr>:e
                                <token ')'>
                       <stmt>:s                                                                    => [{#forIn. v. e. s}]
                 | <token 'switch'> <token '('> <expr>:e <token ')'> <token '{'>
                     ( <token 'case'> <expr>:c <token ':'> <srcElems>:cs => [{#case. c. cs}]
                     | <token 'default'> <token ':'> <srcElems>:cs       => [{#default. cs}] )*:cs
                     <token '}'>                                                                   => [{#switch. e} concat: cs]
                 | <token 'break'> <sc>                                                            => [{#break}]
                 | <token 'continue'> <sc>                                                         => [{#continue}]
                 | <token 'throw'> <spacesNoNl> <expr>:e <sc>                                      => [{#throw. e}]
                 | <token 'try'> <block>:t
                     <token 'catch'> <token '('> <token 'name'>:e <token ')'> <block>:c
                     ( <token 'finally'> <block>
                     | <empty> => [{#get. 'undefined'}] ):f                                        => [{#try. t. e. c. f}]
                 | <token 'return'> ( <expr>
                                    | <empty> => [{#get. 'undefined'}] ):e <sc>                    => [{#return. e}]
                 | <expr>:e <sc>                                                                   => [e].
  srcElem      ::= <token 'function'> <token 'name'>:n <funcRest>:f                                => [{#var. n. f}]
                 | <stmt>.
  srcElems     ::= <srcElem>*:ss                                                                   => [{#begin} concat: ss].
}.

JSParser at: #keywords put: Object new.
keywords := #(break case catch continue default delete do else finally for function if
              in instanceof new return switch this throw try typeof var void while with).
keywords do: [:k |
  (JSParser at: #keywords) at: k put: true
].
JSParser isKeyword: k [^ (self at: #keywords) hasOwnProperty: k].
</script>

<script type="application/javascript-lazy" id="jsparser">
JSParser = Parser.delegated(); JSParser.nameFirst = function() { var $elf = this;  return this._or(function() { return $elf._or(function() { return $elf._apply('letter') }, function() { return $elf._applyWithArgs('exactly', '$') }) }) }; JSParser.nameRest = function() { var $elf = this;  return this._or(function() { return $elf._or(function() { return $elf._apply('letterOrDigit') }, function() { return $elf._applyWithArgs('exactly', '$') }) }) }; JSParser.iName = function() { var $elf = this; var r;  return this._or(function() { return $elf._or(function() { r = $elf._applyWithArgs('firstAndRest', 'nameFirst', 'nameRest'); return (function() { return (r).join('') })() }) }) }; JSParser.name = function() { var $elf = this; var n;  return this._or(function() { return $elf._or(function() { n = $elf._apply('iName'); $elf._pred((function() { return (($elf).isKeyword(n)).sendUnaryMessage('not') })()); return (function() { return ['name', n] })() }) }) }; JSParser.keyword = function() { var $elf = this; var k;  return this._or(function() { return $elf._or(function() { k = $elf._apply('iName'); $elf._pred((function() { return ($elf).isKeyword(k) })()); return (function() { return [k, k] })() }) }) }; JSParser.number = function() { var $elf = this; var ds;  return this._or(function() { return $elf._or(function() { ds = $elf._many1(function() { return $elf._apply('digit') }); return (function() { return ['number', (parseInt).value(((ds).join('')))] })() }) }) }; JSParser.escapeChar = function() { var $elf = this; var c;  return this._or(function() { return $elf._or(function() { $elf._applyWithArgs('exactly', '\\'); c = $elf._apply('char'); return (function() { return '\\'.sendBinaryMessage(',', c) })() }) }) }; JSParser.str = function() { var $elf = this; var cs;  return this._or(function() { return $elf._or(function() { (function() { $elf._applyWithArgs('exactly', '\'');  return '\'' })(); cs = $elf._many(function() { return $elf._or(function() { return $elf._apply('escapeChar') }, function() { $elf._not(function() { return (function() { $elf._applyWithArgs('exactly', '\'');  return '\'' })() }); return $elf._apply('char') }) }); (function() { $elf._applyWithArgs('exactly', '\'');  return '\'' })(); return (function() { return ['string', (cs).join('')] })() }, function() { $elf._applyWithArgs('exactly', '"'); cs = $elf._many(function() { return $elf._or(function() { return $elf._apply('escapeChar') }, function() { $elf._not(function() { return $elf._applyWithArgs('exactly', '"') }); return $elf._apply('char') }) }); $elf._applyWithArgs('exactly', '"'); return (function() { return ['string', (cs).join('')] })() }) }) }; JSParser.special = function() { var $elf = this; var s;  return this._or(function() { return $elf._or(function() { s = $elf._or(function() { return (function() { $elf._applyWithArgs('exactly', '(');  return '(' })() }, function() { return (function() { $elf._applyWithArgs('exactly', ')');  return ')' })() }, function() { return (function() { $elf._applyWithArgs('exactly', '{');  return '{' })() }, function() { return (function() { $elf._applyWithArgs('exactly', '}');  return '}' })() }, function() { return (function() { $elf._applyWithArgs('exactly', '[');  return '[' })() }, function() { return (function() { $elf._applyWithArgs('exactly', ']');  return ']' })() }, function() { return (function() { $elf._applyWithArgs('exactly', ',');  return ',' })() }, function() { return (function() { $elf._applyWithArgs('exactly', ';');  return ';' })() }, function() { return (function() { $elf._applyWithArgs('exactly', '?');  return '?' })() }, function() { return (function() { $elf._applyWithArgs('exactly', ':');  return ':' })() }, function() { return (function() { $elf._applyWithArgs('exactly', '!');$elf._applyWithArgs('exactly', '=');$elf._applyWithArgs('exactly', '=');  return '!==' })() }, function() { return (function() { $elf._applyWithArgs('exactly', '!');$elf._applyWithArgs('exactly', '=');  return '!=' })() }, function() { return (function() { $elf._applyWithArgs('exactly', '=');$elf._applyWithArgs('exactly', '=');$elf._applyWithArgs('exactly', '=');  return '===' })() }, function() { return (function() { $elf._applyWithArgs('exactly', '=');$elf._applyWithArgs('exactly', '=');  return '==' })() }, function() { return (function() { $elf._applyWithArgs('exactly', '=');  return '=' })() }, function() { return (function() { $elf._applyWithArgs('exactly', '>');$elf._applyWithArgs('exactly', '=');  return '>=' })() }, function() { return (function() { $elf._applyWithArgs('exactly', '>');  return '>' })() }, function() { return (function() { $elf._applyWithArgs('exactly', '<');$elf._applyWithArgs('exactly', '=');  return '<=' })() }, function() { return (function() { $elf._applyWithArgs('exactly', '<');  return '<' })() }, function() { return (function() { $elf._applyWithArgs('exactly', '+');$elf._applyWithArgs('exactly', '+');  return '++' })() }, function() { return (function() { $elf._applyWithArgs('exactly', '+');$elf._applyWithArgs('exactly', '=');  return '+=' })() }, function() { return (function() { $elf._applyWithArgs('exactly', '+');  return '+' })() }, function() { return (function() { $elf._applyWithArgs('exactly', '-');$elf._applyWithArgs('exactly', '-');  return '--' })() }, function() { return (function() { $elf._applyWithArgs('exactly', '-');$elf._applyWithArgs('exactly', '=');  return '-=' })() }, function() { return (function() { $elf._applyWithArgs('exactly', '-');  return '-' })() }, function() { return (function() { $elf._applyWithArgs('exactly', '*');$elf._applyWithArgs('exactly', '=');  return '*=' })() }, function() { return (function() { $elf._applyWithArgs('exactly', '*');  return '*' })() }, function() { return (function() { $elf._applyWithArgs('exactly', '/');$elf._applyWithArgs('exactly', '=');  return '/=' })() }, function() { return (function() { $elf._applyWithArgs('exactly', '/');  return '/' })() }, function() { return (function() { $elf._applyWithArgs('exactly', '%');$elf._applyWithArgs('exactly', '=');  return '%=' })() }, function() { return (function() { $elf._applyWithArgs('exactly', '%');  return '%' })() }, function() { return (function() { $elf._applyWithArgs('exactly', '&');$elf._applyWithArgs('exactly', '&');$elf._applyWithArgs('exactly', '=');  return '&&=' })() }, function() { return (function() { $elf._applyWithArgs('exactly', '&');$elf._applyWithArgs('exactly', '&');  return '&&' })() }, function() { return (function() { $elf._applyWithArgs('exactly', '|');$elf._applyWithArgs('exactly', '|');$elf._applyWithArgs('exactly', '=');  return '||=' })() }, function() { return (function() { $elf._applyWithArgs('exactly', '|');$elf._applyWithArgs('exactly', '|');  return '||' })() }, function() { return (function() { $elf._applyWithArgs('exactly', '.');  return '.' })() }, function() { return (function() { $elf._applyWithArgs('exactly', '!');  return '!' })() }); return (function() { return [s, s] })() }) }) }; JSParser.tok = function() { var $elf = this;  return this._or(function() { return $elf._or(function() { $elf._apply('spaces'); return $elf._or(function() { return $elf._apply('name') }, function() { return $elf._apply('keyword') }, function() { return $elf._apply('number') }, function() { return $elf._apply('str') }, function() { return $elf._apply('special') }) }) }) }; JSParser.toks = function() { var $elf = this; var ts;  return this._or(function() { return $elf._or(function() { ts = $elf._many(function() { return $elf._apply('token') }); $elf._apply('spaces'); $elf._apply('end'); return (function() { return ts })() }) }) }; JSParser.token = function() { var $elf = this; var tt, t;  return this._or(function() { tt = $elf._apply('anything'); return $elf._or(function() { t = $elf._apply('tok'); $elf._pred((function() { return ((t).at((0))).sendBinaryMessage('=', tt) })()); return (function() { return (t).at((1)) })() }) }) }; JSParser.spacesNoNl = function() { var $elf = this;  return this._or(function() { return $elf._or(function() { return $elf._many(function() { return $elf._or(function() { $elf._not(function() { return $elf._applyWithArgs('exactly', '\n') }); return $elf._apply('space') }) }) }) }) }; JSParser.expr = function() { var $elf = this; var e, t, f, rhs;  return this._or(function() { return $elf._or(function() { e = $elf._apply('orExpr'); return $elf._or(function() { $elf._applyWithArgs('token', '?'); t = $elf._apply('expr'); $elf._applyWithArgs('token', ':'); f = $elf._apply('expr'); return (function() { return ['condExpr', e, t, f] })() }, function() { $elf._applyWithArgs('token', '='); rhs = $elf._apply('expr'); return (function() { return ['set', e, rhs] })() }, function() { $elf._applyWithArgs('token', '+='); rhs = $elf._apply('expr'); return (function() { return ['mset', e, '+', rhs] })() }, function() { $elf._applyWithArgs('token', '-='); rhs = $elf._apply('expr'); return (function() { return ['mset', e, '-', rhs] })() }, function() { $elf._applyWithArgs('token', '*='); rhs = $elf._apply('expr'); return (function() { return ['mset', e, '*', rhs] })() }, function() { $elf._applyWithArgs('token', '/='); rhs = $elf._apply('expr'); return (function() { return ['mset', e, '/', rhs] })() }, function() { $elf._applyWithArgs('token', '%='); rhs = $elf._apply('expr'); return (function() { return ['mset', e, '%', rhs] })() }, function() { $elf._applyWithArgs('token', '&&='); rhs = $elf._apply('expr'); return (function() { return ['mset', e, '&&', rhs] })() }, function() { $elf._applyWithArgs('token', '||='); rhs = $elf._apply('expr'); return (function() { return ['mset', e, '||', rhs] })() }, function() { $elf._apply('empty'); return (function() { return e })() }) }) }) }; JSParser.orExpr = function() { var $elf = this; var x, y;  return this._or(function() { return $elf._or(function() { x = $elf._apply('orExpr'); $elf._applyWithArgs('token', '||'); y = $elf._apply('andExpr'); return (function() { return ['binop', '||', x, y] })() }, function() { return $elf._apply('andExpr') }) }) }; JSParser.andExpr = function() { var $elf = this; var x, y;  return this._or(function() { return $elf._or(function() { x = $elf._apply('andExpr'); $elf._applyWithArgs('token', '&&'); y = $elf._apply('eqExpr'); return (function() { return ['binop', '&&', x, y] })() }, function() { return $elf._apply('eqExpr') }) }) }; JSParser.eqExpr = function() { var $elf = this; var x, y;  return this._or(function() { return $elf._or(function() { x = $elf._apply('eqExpr'); return $elf._or(function() { $elf._applyWithArgs('token', '=='); y = $elf._apply('relExpr'); return (function() { return ['binop', '==', x, y] })() }, function() { $elf._applyWithArgs('token', '!='); y = $elf._apply('relExpr'); return (function() { return ['binop', '!=', x, y] })() }, function() { $elf._applyWithArgs('token', '==='); y = $elf._apply('relExpr'); return (function() { return ['binop', '===', x, y] })() }, function() { $elf._applyWithArgs('token', '!=='); y = $elf._apply('relExpr'); return (function() { return ['binop', '!==', x, y] })() }) }, function() { return $elf._apply('relExpr') }) }) }; JSParser.relExpr = function() { var $elf = this; var x, y;  return this._or(function() { return $elf._or(function() { x = $elf._apply('relExpr'); return $elf._or(function() { $elf._applyWithArgs('token', '>'); y = $elf._apply('addExpr'); return (function() { return ['binop', '>', x, y] })() }, function() { $elf._applyWithArgs('token', '>='); y = $elf._apply('addExpr'); return (function() { return ['binop', '>=', x, y] })() }, function() { $elf._applyWithArgs('token', '<'); y = $elf._apply('addExpr'); return (function() { return ['binop', '<', x, y] })() }, function() { $elf._applyWithArgs('token', '<='); y = $elf._apply('addExpr'); return (function() { return ['binop', '>=', x, y] })() }, function() { $elf._applyWithArgs('token', 'instanceof'); y = $elf._apply('addExpr'); return (function() { return ['binop', 'instanceof', x, y] })() }) }, function() { return $elf._apply('addExpr') }) }) }; JSParser.addExpr = function() { var $elf = this; var x, y;  return this._or(function() { return $elf._or(function() { x = $elf._apply('addExpr'); $elf._applyWithArgs('token', '+'); y = $elf._apply('mulExpr'); return (function() { return ['binop', '+', x, y] })() }, function() { x = $elf._apply('addExpr'); $elf._applyWithArgs('token', '-'); y = $elf._apply('mulExpr'); return (function() { return ['binop', '-', x, y] })() }, function() { return $elf._apply('mulExpr') }) }) }; JSParser.mulExpr = function() { var $elf = this; var x, y;  return this._or(function() { return $elf._or(function() { x = $elf._apply('mulExpr'); $elf._applyWithArgs('token', '*'); y = $elf._apply('mulExpr'); return (function() { return ['binop', '*', x, y] })() }, function() { x = $elf._apply('mulExpr'); $elf._applyWithArgs('token', '/'); y = $elf._apply('mulExpr'); return (function() { return ['binop', '/', x, y] })() }, function() { x = $elf._apply('mulExpr'); $elf._applyWithArgs('token', '%'); y = $elf._apply('mulExpr'); return (function() { return ['binop', '%', x, y] })() }, function() { return $elf._apply('unary') }) }) }; JSParser.unary = function() { var $elf = this; var p;  return this._or(function() { return $elf._or(function() { $elf._applyWithArgs('token', '-'); p = $elf._apply('postfix'); return (function() { return ['unop', '-', p] })() }, function() { $elf._applyWithArgs('token', '+'); p = $elf._apply('postfix'); return (function() { return p })() }, function() { $elf._applyWithArgs('token', '++'); p = $elf._apply('postfix'); return (function() { return ['preOp', '++', p] })() }, function() { $elf._applyWithArgs('token', '--'); p = $elf._apply('postfix'); return (function() { return ['preOp', '--', p] })() }, function() { $elf._applyWithArgs('token', '!'); p = $elf._apply('postfix'); return (function() { return ['unop', '!', p] })() }, function() { return $elf._apply('postfix') }) }) }; JSParser.postfix = function() { var $elf = this; var p;  return this._or(function() { return $elf._or(function() { p = $elf._apply('primExpr'); return $elf._or(function() { $elf._apply('spacesNoNl'); $elf._applyWithArgs('token', '++'); return (function() { return ['postOp', '++', p] })() }, function() { $elf._apply('spacesNoNl'); $elf._applyWithArgs('token', '--'); return (function() { return ['postOp', '--', p] })() }, function() { $elf._apply('empty'); return (function() { return p })() }) }) }) }; JSParser.primExpr = function() { var $elf = this; var p, i, m, as, f;  return this._or(function() { return $elf._or(function() { p = $elf._apply('primExpr'); return $elf._or(function() { $elf._applyWithArgs('token', '['); i = $elf._apply('expr'); $elf._applyWithArgs('token', ']'); return (function() { return ['get', i, p] })() }, function() { $elf._applyWithArgs('token', '.'); m = $elf._applyWithArgs('token', 'name'); $elf._applyWithArgs('token', '('); as = $elf._applyWithArgs('listOf', 'expr', ','); $elf._applyWithArgs('token', ')'); return (function() { return (['send', m, p]).concat(as) })() }, function() { $elf._applyWithArgs('token', '.'); f = $elf._applyWithArgs('token', 'name'); return (function() { return ['get', ['string', f], p] })() }, function() { $elf._applyWithArgs('token', '('); as = $elf._applyWithArgs('listOf', 'expr', ','); $elf._applyWithArgs('token', ')'); return (function() { return (['call', p]).concat(as) })() }) }, function() { return $elf._apply('primExprHd') }) }) }; JSParser.primExprHd = function() { var $elf = this; var e, n, s, as, es;  return this._or(function() { return $elf._or(function() { $elf._applyWithArgs('token', '('); e = $elf._apply('expr'); $elf._applyWithArgs('token', ')'); return (function() { return e })() }, function() { $elf._applyWithArgs('token', 'this'); return (function() { return ['this'] })() }, function() { n = $elf._applyWithArgs('token', 'name'); return (function() { return ['get', n] })() }, function() { n = $elf._applyWithArgs('token', 'number'); return (function() { return ['number', n] })() }, function() { s = $elf._applyWithArgs('token', 'string'); return (function() { return ['string', s] })() }, function() { $elf._applyWithArgs('token', 'function'); return $elf._apply('funcRest') }, function() { $elf._applyWithArgs('token', 'new'); n = $elf._applyWithArgs('token', 'name'); $elf._applyWithArgs('token', '('); as = $elf._applyWithArgs('listOf', 'expr', ','); $elf._applyWithArgs('token', ')'); return (function() { return (['new', n]).concat(as) })() }, function() { $elf._applyWithArgs('token', '['); es = $elf._applyWithArgs('listOf', 'expr', ','); $elf._applyWithArgs('token', ']'); return (function() { return (['arr']).concat(es) })() }, function() { return $elf._apply('json') }) }) }; JSParser.json = function() { var $elf = this; var bs;  return this._or(function() { return $elf._or(function() { $elf._applyWithArgs('token', '{'); bs = $elf._applyWithArgs('listOf', 'jsonBinding', ','); $elf._applyWithArgs('token', '}'); return (function() { return (['json']).concat(bs) })() }) }) }; JSParser.jsonBinding = function() { var $elf = this; var n, v;  return this._or(function() { return $elf._or(function() { n = $elf._apply('jsonPropName'); $elf._applyWithArgs('token', ':'); v = $elf._apply('expr'); return (function() { return ['binding', n, v] })() }) }) }; JSParser.jsonPropName = function() { var $elf = this;  return this._or(function() { return $elf._or(function() { return $elf._applyWithArgs('token', 'name') }, function() { return $elf._applyWithArgs('token', 'number') }, function() { return $elf._applyWithArgs('token', 'string') }) }) }; JSParser.formal = function() { var $elf = this;  return this._or(function() { return $elf._or(function() { $elf._apply('spaces'); return $elf._applyWithArgs('token', 'name') }) }) }; JSParser.funcRest = function() { var $elf = this; var fs, body;  return this._or(function() { return $elf._or(function() { $elf._applyWithArgs('token', '('); fs = $elf._applyWithArgs('listOf', 'formal', ','); $elf._applyWithArgs('token', ')'); $elf._applyWithArgs('token', '{'); body = $elf._apply('srcElems'); $elf._applyWithArgs('token', '}'); return (function() { return ['func', (['formals']).concat(fs), body] })() }) }) }; JSParser.sc = function() { var $elf = this;  return this._or(function() { return $elf._or(function() { $elf._apply('spacesNoNl'); return $elf._or(function() { return $elf._applyWithArgs('exactly', '\n') }, function() { return $elf._lookahead(function() { return $elf._applyWithArgs('exactly', '}') }) }, function() { return $elf._apply('end') }) }, function() { return $elf._applyWithArgs('token', ';') }) }) }; JSParser.binding = function() { var $elf = this; var n, v;  return this._or(function() { return $elf._or(function() { n = $elf._applyWithArgs('token', 'name'); v = $elf._or(function() { $elf._applyWithArgs('token', '='); return $elf._apply('expr') }, function() { $elf._apply('empty'); return (function() { return ['get', 'undefined'] })() }); return (function() { return ['var', n, v] })() }) }) }; JSParser.block = function() { var $elf = this; var ss;  return this._or(function() { return $elf._or(function() { $elf._applyWithArgs('token', '{'); ss = $elf._apply('srcElems'); $elf._applyWithArgs('token', '}'); return (function() { return ss })() }) }) }; JSParser.stmt = function() { var $elf = this; var bs, c, t, f, s, i, u, n, v, e, cs;  return this._or(function() { return $elf._or(function() { return $elf._apply('block') }, function() { $elf._applyWithArgs('token', 'var'); bs = $elf._applyWithArgs('listOf', 'binding', ','); $elf._apply('sc'); return (function() { return (['begin']).concat(bs) })() }, function() { $elf._applyWithArgs('token', 'if'); $elf._applyWithArgs('token', '('); c = $elf._apply('expr'); $elf._applyWithArgs('token', ')'); t = $elf._apply('stmt'); f = $elf._or(function() { $elf._applyWithArgs('token', 'else'); return $elf._apply('stmt') }, function() { $elf._apply('empty'); return (function() { return ['get', 'undefined'] })() }); return (function() { return ['if', c, t, f] })() }, function() { $elf._applyWithArgs('token', 'while'); $elf._applyWithArgs('token', '('); c = $elf._apply('expr'); $elf._applyWithArgs('token', ')'); s = $elf._apply('stmt'); return (function() { return ['while', c, s] })() }, function() { $elf._applyWithArgs('token', 'do'); s = $elf._apply('stmt'); $elf._applyWithArgs('token', 'while'); $elf._applyWithArgs('token', '('); c = $elf._apply('expr'); $elf._applyWithArgs('token', ')'); $elf._apply('sc'); return (function() { return ['doWhile', s, c] })() }, function() { $elf._applyWithArgs('token', 'for'); $elf._applyWithArgs('token', '('); i = $elf._or(function() { $elf._applyWithArgs('token', 'var'); return $elf._apply('binding') }, function() { return $elf._apply('expr') }, function() { $elf._apply('empty'); return (function() { return ['get', 'undefined'] })() }); $elf._applyWithArgs('token', ';'); c = $elf._or(function() { return $elf._apply('expr') }, function() { $elf._apply('empty'); return (function() { return ['get', 'true'] })() }); $elf._applyWithArgs('token', ';'); u = $elf._or(function() { return $elf._apply('expr') }, function() { $elf._apply('empty'); return (function() { return ['get', 'undefined'] })() }); $elf._applyWithArgs('token', ')'); s = $elf._apply('stmt'); return (function() { return ['for', i, c, u, s] })() }, function() { $elf._applyWithArgs('token', 'for'); $elf._applyWithArgs('token', '('); v = $elf._or(function() { $elf._applyWithArgs('token', 'var'); n = $elf._applyWithArgs('token', 'name'); return (function() { return ['var', n, ['get', 'undefined']] })() }, function() { return $elf._apply('expr') }); $elf._applyWithArgs('token', 'in'); e = $elf._apply('expr'); $elf._applyWithArgs('token', ')'); s = $elf._apply('stmt'); return (function() { return ['forIn', v, e, s] })() }, function() { $elf._applyWithArgs('token', 'switch'); $elf._applyWithArgs('token', '('); e = $elf._apply('expr'); $elf._applyWithArgs('token', ')'); $elf._applyWithArgs('token', '{'); cs = $elf._many(function() { return $elf._or(function() { $elf._applyWithArgs('token', 'case'); c = $elf._apply('expr'); $elf._applyWithArgs('token', ':'); cs = $elf._apply('srcElems'); return (function() { return ['case', c, cs] })() }, function() { $elf._applyWithArgs('token', 'default'); $elf._applyWithArgs('token', ':'); cs = $elf._apply('srcElems'); return (function() { return ['default', cs] })() }) }); $elf._applyWithArgs('token', '}'); return (function() { return (['switch', e]).concat(cs) })() }, function() { $elf._applyWithArgs('token', 'break'); $elf._apply('sc'); return (function() { return ['break'] })() }, function() { $elf._applyWithArgs('token', 'continue'); $elf._apply('sc'); return (function() { return ['continue'] })() }, function() { $elf._applyWithArgs('token', 'throw'); $elf._apply('spacesNoNl'); e = $elf._apply('expr'); $elf._apply('sc'); return (function() { return ['throw', e] })() }, function() { $elf._applyWithArgs('token', 'try'); t = $elf._apply('block'); $elf._applyWithArgs('token', 'catch'); $elf._applyWithArgs('token', '('); e = $elf._applyWithArgs('token', 'name'); $elf._applyWithArgs('token', ')'); c = $elf._apply('block'); f = $elf._or(function() { $elf._applyWithArgs('token', 'finally'); return $elf._apply('block') }, function() { $elf._apply('empty'); return (function() { return ['get', 'undefined'] })() }); return (function() { return ['try', t, e, c, f] })() }, function() { $elf._applyWithArgs('token', 'return'); e = $elf._or(function() { return $elf._apply('expr') }, function() { $elf._apply('empty'); return (function() { return ['get', 'undefined'] })() }); $elf._apply('sc'); return (function() { return ['return', e] })() }, function() { e = $elf._apply('expr'); $elf._apply('sc'); return (function() { return e })() }) }) }; JSParser.srcElem = function() { var $elf = this; var n, f;  return this._or(function() { return $elf._or(function() { $elf._applyWithArgs('token', 'function'); n = $elf._applyWithArgs('token', 'name'); f = $elf._apply('funcRest'); return (function() { return ['var', n, f] })() }, function() { return $elf._apply('stmt') }) }) }; JSParser.srcElems = function() { var $elf = this; var ss;  return this._or(function() { return $elf._or(function() { ss = $elf._many(function() { return $elf._apply('srcElem') }); return (function() { return (['begin']).concat(ss) })() }) }) }; JSParser; JSParser.prototype = JSParser; ; (JSParser).atput('keywords', Object.sendUnaryMessage('new')); keywords = ['break', 'case', 'catch', 'continue', 'default', 'delete', 'do', 'else', 'finally', 'for', 'function', 'if', 'in', 'instanceof', 'new', 'return', 'switch', 'this', 'throw', 'try', 'typeof', 'var', 'void', 'while', 'with']; (keywords).performwithArguments('do', [(function (k) { return (((JSParser).at('keywords'))).atput(k, true);  })]); JSParser.prototype['isKeyword'] = function(k) { var $elf = this; try { ((function () { ; throw new Return(((($elf).at('keywords'))).hasOwnProperty(k)) }))() } catch (_r) { if (_r instanceof Return) return _r.value;else throw _r } return this };

JSParser.prototype['iParse'] = function() {
  try {
    var endIdx = 0, r
    r = this._apply("srcElem"); endIdx = this.input.realPos()
    this._apply("spaces");      endIdx = this.input.realPos()
    this._apply("end")
    return r
  } catch (e) { e.failPos = endIdx; throw e }
}
JSParser.prototype['parse'] = function(code) {
  try { return this.matchAllwith(code, "iParse") }
  catch (e) {
    if (e instanceof Fail) {
      e = code.substring(0, e.failPos - 1) + " Parse error ->" + code.substring(e.failPos - 1)
      alert(e)
    }
    throw e
  }
}
</script>

</head>
<body>

<div id="header">
  <h1 id="title"><a class="headerlink" href="placeholder">TileScript</a></h1>
  <form class="control" id="control" method="post" action="">
    <input type="button" value="home" onclick="go('Home')"/>
    <!-- input type="button" value="do it (Alt + D)" onclick="doIt()" -->
    <input type="button" value="save" onclick="save()"/>
  </form>
<br style="clear: both"/>
</div>

<img id="loading" src="loading_16.gif"/>

<p id="rows"></p>
<br style="clear: both"/>

<hr/>

<div id="footer">
<p><a href="http://tinlizzie.org/svn/trunk/jstile/">http://tinlizzie.org/svn/trunk/jstile/</a></p>
</div>


<div id="transcriptElement">
  <span id="transcriptTab" onclick="$('transcript').toggle()">Transcript [+/-]</span>
  <textarea rows="4" id="transcript"></textArea>
</div>

</body>
</html>
